<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà S. suis ‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡πÇ‡∏£‡∏Ñ - 8 ‡∏î‡πà‡∏≤‡∏ô</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background: url('https://cdn.jsdelivr.net/gh/bunyawatmk/picture/Gemini_Generated_Image_daytzzdaytzzdayt.png') center center fixed;
            background-size: cover;
            color: #334155;
            overscroll-behavior-y: contain;
            min-height: 100vh
        }

        /* Animated background */
        .bg-animate {
            position: fixed;
            inset: 0;
            z-index: 0;
            overflow: hidden;
            pointer-events: none
        }

        .bg-animate::before {
            content: '';
            position: absolute;
            width: 600px;
            height: 600px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(209, 250, 229, 0.6), transparent 70%);
            /* Soft emerald pastel */
            top: -100px;
            right: -100px;
            animation: floatBlob 12s ease-in-out infinite
        }

        .bg-animate::after {
            content: '';
            position: absolute;
            width: 500px;
            height: 500px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(224, 231, 255, 0.6), transparent 70%);
            /* Soft indigo pastel */
            bottom: -80px;
            left: -80px;
            animation: floatBlob 15s ease-in-out infinite reverse
        }

        @keyframes floatBlob {

            0%,
            100% {
                transform: translate(0, 0) scale(1)
            }

            50% {
                transform: translate(40px, 30px) scale(1.1)
            }
        }

        /* Particles */
        .particle {
            position: absolute;
            border-radius: 50%;
            opacity: .4;
            animation: drift linear infinite
        }

        @keyframes drift {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: .4
            }

            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0
            }
        }

        /* Glassmorphism Light */
        .glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 1.25rem;
            box-shadow: 0 4px 20px rgba(148, 163, 184, 0.08);
        }

        .glass-light {
            background: rgba(248, 250, 252, 0.6);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(226, 232, 240, 0.6);
            border-radius: 1rem;
            box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.7);
        }

        /* Cards */
        .card-container {
            perspective: 1000px
        }

        .card {
            position: relative;
            transform-style: preserve-3d;
            transition: transform .6s cubic-bezier(.4, 0, .2, 1);
            cursor: pointer;
            user-select: none;
            -webkit-tap-highlight-color: transparent
        }

        .card.flipped {
            transform: rotateY(180deg)
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: .875rem;
            padding: .5rem;
            text-align: center
        }

        .card-front {
            background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%);
            border: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 0 4px 6px rgba(148, 163, 184, 0.05);
            color: rgba(148, 163, 184, 0.6);
            font-size: 2rem;
            overflow: hidden
        }

        .card-front::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, transparent 30%, rgba(255, 255, 255, 0.8) 50%, transparent 70%);
            animation: shimmer 3s ease-in-out infinite
        }

        @keyframes shimmer {

            0%,
            100% {
                transform: translateX(-100%)
            }

            50% {
                transform: translateX(100%)
            }
        }

        .card-back {
            transform: rotateY(180deg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: .25rem;
            box-shadow: 0 8px 16px rgba(148, 163, 184, 0.1);
        }

        .card-back.q-card {
            background: linear-gradient(135deg, #fffbeb, #fef3c7);
            border: 1px solid rgba(252, 211, 77, 0.4);
            color: #b45309
        }

        .card-back.a-card {
            background: linear-gradient(135deg, #ecfdf5, #d1fae5);
            border: 1px solid rgba(110, 231, 183, 0.4);
            color: #047857
        }

        .text-content {
            font-size: .82rem;
            line-height: 1.35;
            font-weight: 600
        }

        @media(max-width:640px) {
            .text-content {
                font-size: .7rem
            }
        }

        .card:hover:not(.flipped) {
            transform: translateY(-4px)
        }

        .card.flipped:hover {
            transform: rotateY(180deg) translateY(-2px)
        }

        /* Deal animation */
        @keyframes dealIn {
            0% {
                opacity: 0;
                transform: translateY(30px) scale(.9)
            }

            100% {
                opacity: 1;
                transform: translateY(0) scale(1)
            }
        }

        .deal-animate {
            animation: dealIn .4s ease-out forwards;
            opacity: 0
        }

        .matched-glow {
            animation: matchPulse .6s ease-in-out
        }

        @keyframes matchPulse {
            0% {
                transform: rotateY(180deg) scale(1);
                box-shadow: 0 0 0 transparent
            }

            50% {
                transform: rotateY(180deg) scale(1.06);
                box-shadow: 0 0 24px rgba(52, 211, 153, .5)
            }

            100% {
                transform: rotateY(180deg) scale(1);
                box-shadow: 0 0 0 transparent
            }
        }

        /* Level dots */
        .level-dot {
            width: 2.2rem;
            height: 2.2rem;
            min-width: 2.2rem;
            transition: all .3s ease;
            font-size: .75rem;
            background: #ffffff;
            border-color: #cbd5e1;
        }

        .level-dot.active {
            background: linear-gradient(135deg, #10b981, #34d399);
            color: #fff;
            border-color: #34d399;
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(16, 185, 129, .25);
        }

        .level-dot.completed {
            background: #a7f3d0;
            color: #065f46;
            border-color: #6ee7b7;
        }

        .level-line {
            height: 3px;
            flex-grow: 1;
            background: #e2e8f0;
            margin: 0 2px;
            border-radius: 2px;
            transition: background .3s
        }

        .level-line.filled {
            background: linear-gradient(90deg, #34d399, #10b981)
        }

        /* AI corner */
        .ai-pulse {
            animation: aiGlow 2s infinite
        }

        @keyframes aiGlow {

            0%,
            100% {
                box-shadow: 0 0 8px rgba(16, 185, 129, .2)
            }

            50% {
                box-shadow: 0 0 20px rgba(16, 185, 129, .4)
            }
        }

        .typing-loader::after {
            content: '...';
            animation: typing 1.5s steps(4, end) infinite
        }

        @keyframes typing {

            0%,
            100% {
                content: ''
            }

            25% {
                content: '.'
            }

            50% {
                content: '..'
            }

            75% {
                content: '...'
            }
        }

        /* Knowledge hub tabs */
        .tab-pill {
            padding: .65rem 1.2rem;
            border-radius: 9999px;
            font-weight: 700;
            font-size: .85rem;
            transition: all .3s;
            cursor: pointer;
            border: 1px solid transparent;
            white-space: nowrap
        }

        .tab-pill.active-ab {
            background: #e0e7ff;
            color: #4338ca;
            border-color: #c7d2fe;
            box-shadow: 0 2px 8px rgba(99, 102, 241, .15)
        }

        .tab-pill.active-ss {
            background: #ffe4e6;
            color: #be123c;
            border-color: #fecdd3;
            box-shadow: 0 2px 8px rgba(225, 29, 72, .15)
        }

        .tab-pill.active-ga {
            background: #f3e8ff;
            color: #7e22ce;
            border-color: #e9d5ff;
            box-shadow: 0 2px 8px rgba(147, 51, 234, .15)
        }

        .tab-pill.inactive {
            background: #f1f5f9;
            color: #64748b;
            border-color: #e2e8f0;
        }

        .tab-pill.inactive:hover {
            background: #e2e8f0;
            color: #475569
        }

        /* Accordion */
        .acc-item {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: .75rem;
            overflow: hidden;
            transition: all .3s;
            box-shadow: 0 2px 4px rgba(148, 163, 184, 0.05);
        }

        .acc-item:hover {
            border-color: #cbd5e1;
            box-shadow: 0 4px 6px rgba(148, 163, 184, 0.08);
        }

        .acc-item.open {
            border-color: #818cf8;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.1);
        }

        .acc-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height .4s ease, padding .3s;
            padding: 0 1.25rem
        }

        .acc-item.open .acc-body {
            max-height: 2000px;
            padding: 1.25rem
        }

        /* Metric card */
        .metric-card {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: .75rem;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 6px rgba(148, 163, 184, 0.06);
        }

        .metric-card .num {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, #a78bfa, #818cf8);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent
        }

        /* Confetti */
        .confetti-container {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 100;
            overflow: hidden
        }

        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            top: -10px;
            animation: confettiFall linear forwards
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1
            }

            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0
            }
        }

        /* Modal glass */
        .modal-glass {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        .modal-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(226, 232, 240, 0.8);
            border-radius: 1.5rem;
            box-shadow: 0 20px 40px rgba(148, 163, 184, 0.15);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px
        }

        ::-webkit-scrollbar-track {
            background: transparent
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(148, 163, 184, .2);
            border-radius: 3px
        }

        /* Stat pill */
        .stat-pill {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            padding: .35rem .75rem;
            border-radius: 9999px;
            font-size: .8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: .4rem;
            box-shadow: 0 2px 4px rgba(148, 163, 184, 0.05);
        }
    </style>
</head>

<body class="flex flex-col items-center py-6 px-4 pb-24 relative">
    <div class="bg-animate" id="bg-animate"></div>
    <div class="relative z-10 w-full flex flex-col items-center">

        <!-- ===== WELCOME SCREEN ===== -->
        <div id="welcome-screen" class="w-full max-w-2xl mt-8">
            <div class="glass p-8 md:p-10 text-center">
                <div class="relative w-28 h-28 mx-auto mb-6">
                    <div class="absolute inset-0 rounded-full bg-gradient-to-br from-emerald-500/20 to-teal-500/20 animate-ping"
                        style="animation-duration:2s"></div>
                    <div
                        class="relative w-28 h-28 rounded-full bg-gradient-to-br from-emerald-500/30 to-teal-600/30 border border-emerald-500/30 flex items-center justify-center">
                        <i class="fas fa-bacteria text-5xl text-emerald-400"></i>
                    </div>
                </div>
                <h1
                    class="text-3xl md:text-4xl font-extrabold bg-gradient-to-r from-emerald-300 via-teal-200 to-cyan-300 bg-clip-text text-transparent mb-2">
                    S. suis & AMR ‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡πÇ‡∏£‡∏Ñ</h1>
                <p class="text-slate-500 mb-8 text-sm md:text-base">‡πÄ‡∏Å‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÇ‡∏£‡∏Ñ‡∏´‡∏π‡∏î‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡∏°‡∏¥‡∏ï‡∏¥‡∏ó‡∏≤‡∏á‡∏™‡∏±‡∏á‡∏Ñ‡∏° (One Health)
                </p>
                <div class="glass-light rounded-xl p-6 mb-8 text-left">
                    <h2 class="text-lg font-bold text-emerald-600 mb-4 flex items-center"><i
                            class="fas fa-gamepad mr-2 text-emerald-500"></i>‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</h2>
                    <ul class="space-y-3 text-slate-600 text-sm">
                        <li class="flex items-start"><span
                                class="w-7 h-7 rounded-full bg-red-100 flex items-center justify-center mr-3 mt-0.5 flex-shrink-0"><i
                                    class="fas fa-bullseye text-red-500 text-xs"></i></span><span><strong
                                    class="text-slate-700">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:</strong> ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 8 ‡∏î‡πà‡∏≤‡∏ô
                                ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÇ‡∏£‡∏Ñ ‡πÅ‡∏•‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏ó‡∏≤‡∏á‡∏™‡∏±‡∏á‡∏Ñ‡∏°</span></li>
                        <li class="flex items-start"><span
                                class="w-7 h-7 rounded-full bg-blue-100 flex items-center justify-center mr-3 mt-0.5 flex-shrink-0"><i
                                    class="fas fa-hand-pointer text-blue-500 text-xs"></i></span><span><strong
                                    class="text-slate-700">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà:</strong> ‡∏´‡∏≤ <span
                                    class="text-amber-500 font-bold">‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</span> ‡∏Å‡∏±‡∏ö <span
                                    class="text-emerald-500 font-bold">‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</span> ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô</span></li>
                        <li class="flex items-start"><span
                                class="w-7 h-7 rounded-full bg-purple-100 flex items-center justify-center mr-3 mt-0.5 flex-shrink-0"><i
                                    class="fas fa-robot text-purple-500 text-xs"></i></span><span><strong
                                    class="text-slate-700">AI Corner:</strong> ‡πÄ‡∏Å‡∏£‡πá‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏à‡∏≤‡∏Å‡∏û‡∏µ‡πà AI
                                ‡∏à‡∏∞‡πÄ‡∏î‡πâ‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏ñ‡∏π‡∏Å</span></li>
                    </ul>
                </div>
                <button onclick="onStartGame()"
                    class="w-full md:w-auto bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-400 hover:to-teal-400 text-white text-lg font-bold py-4 px-12 rounded-full shadow-lg shadow-emerald-500/25 transform transition-all hover:scale-105 active:scale-95 hover:shadow-emerald-500/40">
                    <i class="fas fa-play mr-2"></i>‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÄ‡∏•‡∏¢!
                </button>
            </div>
        </div>

        <!-- ===== GAME CONTAINER ===== -->
        <div id="game-container" class="w-full flex flex-col items-center hidden">
            <header class="w-full max-w-4xl mb-6 glass p-4 md:p-5">
                <div class="flex justify-between items-end mb-4">
                    <div>
                        <h1
                            class="text-xl md:text-2xl font-extrabold bg-gradient-to-r from-emerald-500 to-teal-600 bg-clip-text text-transparent flex items-center">
                            <i class="fas fa-bacteria mr-2 text-emerald-500 text-lg"></i>S. suis ‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡πÇ‡∏£‡∏Ñ
                        </h1>
                        <p id="level-title" class="text-emerald-600/80 text-xs md:text-sm font-medium mt-1">‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 1:
                            ‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô</p>
                    </div>
                    <div class="flex gap-2 flex-wrap justify-end">
                        <button onclick="openMultiplayerModal()" id="btn-multiplayer"
                            class="stat-pill text-blue-600 hover:bg-blue-50 transition cursor-pointer"><i
                                class="fas fa-users text-xs"></i><span
                                id="multiplayer-status">‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</span></button>
                        <div class="stat-pill text-cyan-600"><i class="fas fa-stopwatch text-xs"></i><span
                                id="time">00:00</span></div>
                        <div class="stat-pill text-amber-500"><i class="fas fa-star text-xs"></i><span
                                id="moves">0</span></div>
                    </div>
                </div>
                <div class="flex items-center justify-between px-1 overflow-x-auto pb-1">
                    <div class="level-dot rounded-full flex items-center justify-center font-bold text-slate-400 active"
                        id="dot-1">1</div>
                    <div class="level-line" id="line-1"></div>
                    <div class="level-dot rounded-full flex items-center justify-center font-bold text-slate-400"
                        id="dot-2">2</div>
                    <div class="level-line" id="line-2"></div>
                    <div class="level-dot rounded-full flex items-center justify-center font-bold text-slate-400"
                        id="dot-3">3</div>
                    <div class="level-line" id="line-3"></div>
                    <div class="level-dot rounded-full flex items-center justify-center font-bold text-slate-400"
                        id="dot-4">4</div>
                    <div class="level-line" id="line-4"></div>
                    <div class="level-dot rounded-full flex items-center justify-center font-bold text-slate-400"
                        id="dot-5">5</div>
                    <div class="level-line" id="line-5"></div>
                    <div class="level-dot rounded-full flex items-center justify-center font-bold text-slate-400"
                        id="dot-6">6</div>
                </div>
            </header>

            <div id="game-board" class="grid w-full max-w-4xl mx-auto transition-all duration-300 mb-6"></div>

            <!-- AI Corner -->
            <div id="ai-corner" class="w-full max-w-4xl glass overflow-hidden hidden mt-4 border-emerald-200">
                <div class="bg-emerald-50 p-3 border-b border-emerald-100 flex justify-between items-center">
                    <h3 class="font-bold text-emerald-700 flex items-center text-sm"><i
                            class="fas fa-sparkles text-amber-500 mr-2"></i>‡πÄ‡∏Å‡∏£‡πá‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏à‡∏≤‡∏Å‡∏û‡∏µ‡πà AI</h3>
                    <span
                        class="text-[.65rem] text-emerald-600 bg-emerald-100 px-2 py-0.5 rounded-full border border-emerald-200">Powered
                        by Gemini</span>
                </div>
                <div class="p-4">
                    <div id="ai-loading" class="hidden text-emerald-600 italic text-sm"><i
                            class="fas fa-robot mr-2 animate-bounce"></i>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ<span
                            class="typing-loader"></span></div>
                    <div id="ai-content" class="hidden">
                        <p id="ai-text" class="text-slate-700 leading-relaxed mb-3 text-sm"></p>
                        <button onclick="playAIAudio()" id="btn-play-audio"
                            class="text-sm bg-emerald-100 hover:bg-emerald-200 text-emerald-700 py-1.5 px-4 rounded-full transition flex items-center w-max border border-emerald-200"><i
                                class="fas fa-volume-up mr-2"></i>‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button>
                        <div id="audio-loading" class="hidden text-xs text-emerald-600 mt-1"><i
                                class="fas fa-circle-notch fa-spin mr-1"></i>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á...</div>
                    </div>
                    <div id="ai-empty" class="text-slate-400 text-center py-2 text-sm italic">
                        ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏Å‡∏£‡πá‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ!</div>
                </div>
            </div>

            <!-- Knowledge Hub Button & Box -->
            <div class="w-full max-w-4xl flex flex-col items-center mt-8 mb-6">
                <button onclick="toggleKnowledgeBox()"
                    class="bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-500 hover:to-violet-500 text-white font-bold py-3 px-8 rounded-full shadow-lg shadow-indigo-500/20 transform transition-all hover:scale-105 active:scale-95 flex items-center text-sm"><i
                        class="fas fa-book-open mr-2"></i>‡∏Ñ‡∏•‡∏±‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ</button>
                <div id="manual-knowledge-box"
                    class="w-full mt-4 glass hidden transition-all duration-300 overflow-hidden">
                    <div class="p-5 md:p-6">
                        <header class="text-center mb-6">
                            <h2
                                class="text-xl md:text-2xl font-extrabold bg-gradient-to-r from-indigo-500 via-violet-500 to-purple-500 bg-clip-text text-transparent mb-1">
                                Knowledge Hub</h2>
                            <p class="text-slate-500 text-xs md:text-sm">‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏™‡∏±‡∏ï‡∏ß‡πå ¬∑ ‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏° ¬∑ One Health</p>
                        </header>
                        <div class="flex flex-wrap justify-center gap-2 mb-6" id="tab-bar">
                            <button onclick="switchTab('antibiotics')" id="tab-antibiotics"
                                class="tab-pill active-ab"><i class="fas fa-seedling mr-1.5"></i>‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏î‡πÅ‡∏ó‡∏ô</button>
                            <button onclick="switchTab('ssuis')" id="tab-ssuis" class="tab-pill inactive"><i
                                    class="fas fa-bacteria mr-1.5"></i>S. suis</button>
                            <button onclick="switchTab('gender_amr')" id="tab-gender" class="tab-pill inactive"><i
                                    class="fas fa-venus-mars mr-1.5"></i>Gender & AMR</button>
                        </div>
                        <div id="section-header" class="mb-5 text-center">
                            <h2 class="text-base md:text-lg font-bold text-slate-700 mb-0.5" id="section-title">
                                ‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞</h2>
                            <p class="text-slate-500 text-xs" id="section-subtitle">
                                ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏±‡πà‡∏á‡∏¢‡∏∑‡∏ô‡πÉ‡∏ô‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏Å‡∏£‡∏£‡∏°‡∏õ‡∏®‡∏∏‡∏™‡∏±‡∏ï‡∏ß‡πå</p>
                        </div>
                        <div id="accordion-container" class="space-y-2"></div>
                        <footer class="mt-6 text-center text-slate-400 text-[.65rem]">
                            <p>¬© 2024 One Health Knowledge Base</p>
                        </footer>
                    </div>
                </div>
            </div>
        </div>

        <!-- Level Complete Modal -->
        <div id="level-modal" class="fixed inset-0 modal-glass flex items-center justify-center z-50 hidden">
            <div class="modal-card p-8 text-center max-w-sm mx-4">
                <div
                    class="w-16 h-16 rounded-full bg-emerald-100 border border-emerald-200 flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-check text-3xl text-emerald-500"></i>
                </div>
                <h2 class="text-2xl font-extrabold text-slate-800 mb-2">‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô <span id="modal-level-num">1</span>!
                </h2>
                <p class="text-slate-500 mb-4 text-sm" id="modal-msg">‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å! ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡πà‡∏≤‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ?</p>
                <div class="flex justify-center gap-4 mb-6 text-xs text-slate-500">
                    <div><i class="fas fa-clock mr-1"></i><span id="level-time">00:00</span></div>
                    <div><i class="fas fa-hand-pointer mr-1"></i><span id="level-moves">0</span> ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
                </div>
                <button onclick="nextLevel()"
                    class="w-full bg-gradient-to-r from-emerald-400 to-teal-400 hover:from-emerald-300 hover:to-teal-300 text-white font-bold py-3 px-6 rounded-xl shadow-lg shadow-emerald-500/20 transition flex items-center justify-center">‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                    <i class="fas fa-arrow-right ml-2"></i></button>
            </div>
        </div>

        <!-- Victory Modal -->
        <div id="victory-modal" class="fixed inset-0 modal-glass flex items-center justify-center z-50 hidden">
            <div id="confetti-zone"></div>
            <div class="modal-card p-8 text-center max-w-sm mx-4 relative overflow-hidden">
                <div
                    class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-yellow-300 via-orange-400 to-red-400">
                </div>
                <div
                    class="w-20 h-20 rounded-full bg-yellow-100 border border-yellow-200 flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-trophy text-4xl text-yellow-500"></i>
                </div>
                <h2
                    class="text-3xl font-extrabold bg-gradient-to-r from-yellow-500 to-amber-500 bg-clip-text text-transparent mb-2">
                    ‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç S. suis!</h2>
                <p class="text-slate-500 mb-6 text-sm">‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏£‡∏ö 8 ‡∏î‡πà‡∏≤‡∏ô ‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!</p>
                <div class="glass-light p-4 rounded-xl mb-6">
                    <p class="text-xs text-slate-500 mb-1">‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏ß‡∏°</p>
                    <p class="text-2xl font-extrabold text-emerald-500" id="total-time">00:00</p>
                </div>
                <button onclick="restartGame()"
                    class="w-full bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold py-3 px-8 rounded-xl transition"><i
                        class="fas fa-redo mr-2"></i>‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
            </div>
        </div>

        <!-- Multiplayer Modal -->
        <div id="multiplayer-modal" class="fixed inset-0 modal-glass flex items-center justify-center z-50 hidden">
            <div class="modal-card p-6 max-w-sm w-full mx-4">
                <h2 class="text-lg font-bold text-slate-800 mb-4 flex items-center"><i
                        class="fas fa-wifi text-blue-500 mr-2"></i>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</h2>
                <div class="mb-4">
                    <label class="block text-slate-600 text-xs font-bold mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á (Room ID)</label>
                    <input type="text" id="room-id-input"
                        class="w-full bg-white border border-slate-300 rounded-lg py-2.5 px-3 text-slate-800 text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition shadow-sm"
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô room123">
                    <p class="text-[.65rem] text-slate-500 mt-1">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô</p>
                </div>
                <div class="flex justify-end gap-2">
                    <button onclick="document.getElementById('multiplayer-modal').classList.add('hidden')"
                        class="bg-slate-100 hover:bg-slate-200 text-slate-600 font-bold py-2 px-4 rounded-lg text-sm transition">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button onclick="connectMQTT()"
                        class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded-lg text-sm transition shadow-sm border border-blue-500">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</button>
                </div>
            </div>
        </div>

    </div><!-- end relative z-10 -->

    <script src="https://unpkg.com/paho-mqtt@1.1.0/paho-mqtt.min.js"></script>
    
    
    <script>
// --- Knowledge Hub Data & Logic ---
const knowledgeData = {
    antibiotics: [
        {
            title: "‡∏ó‡∏µ‡πà‡∏°‡∏≤‡πÅ‡∏•‡∏∞‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏î‡∏∑‡πâ‡∏≠‡∏¢‡∏≤ (AMR)", icon: "fa-exclamation-triangle", color: "text-red-500",
            content: `<div class="space-y-3 text-sm text-slate-600">
            <p>‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô (Overuse) ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏ú‡∏¥‡∏î‡∏ß‡∏¥‡∏ò‡∏µ (Misuse) ‡∏Å‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏ß‡∏¥‡∏Å‡∏§‡∏ï <strong class="text-red-500">"‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏î‡∏∑‡πâ‡∏≠‡∏¢‡∏≤‡∏ï‡πâ‡∏≤‡∏ô‡∏à‡∏∏‡∏•‡∏ä‡∏µ‡∏û" (AMR)</strong> ‡∏ã‡∏∂‡πà‡∏á‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏™‡∏±‡∏ï‡∏ß‡πå ‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏° ‡πÅ‡∏•‡∏∞‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå ‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î "‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß" (One Health)</p>
            <div class="bg-red-50 p-3 rounded-lg border-l-4 border-red-500"><strong class="text-red-600">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á:</strong> ‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÅ‡∏ö‡∏Ñ‡∏ó‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô <em>‡πÑ‡∏°‡πà‡∏Ü‡πà‡∏≤‡πÑ‡∏ß‡∏£‡∏±‡∏™ ‡πÑ‡∏°‡πà‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏•‡∏î‡πÑ‡∏Ç‡πâ</em></div></div>` },
        {
            title: "1. ‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏£‡∏π‡∏õ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ü‡∏≤‡∏£‡πå‡∏°", icon: "fa-shield-alt", color: "text-blue-500",
            content: `<div class="space-y-3 text-sm text-slate-600">
            <p>‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô <strong class="text-blue-500">"‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢"</strong>:</p>
            <ul class="list-disc pl-5 space-y-1"><li><strong class="text-slate-800">Biosecurity:</strong> ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö All-in All-out ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏î‡∏ß‡∏á‡∏à‡∏£‡πÇ‡∏£‡∏Ñ</li>
            <li><strong class="text-slate-800">‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°:</strong> ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡πä‡∏≤‡∏ã‡πÅ‡∏≠‡∏°‡πÇ‡∏°‡πÄ‡∏ô‡∏µ‡∏¢ (‚â§30-50 ppm)</li>
            <li><strong class="text-slate-800">‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£:</strong> ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏ô‡πâ‡∏≥‡∏™‡∏∞‡∏≠‡∏≤‡∏î</li>
            <li><strong class="text-slate-800">‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏•‡∏≥‡πÑ‡∏™‡πâ:</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏¥‡πÄ‡∏ß‡∏®‡∏•‡∏≥‡πÑ‡∏™‡πâ‡∏î‡∏µ = ‡∏†‡∏π‡∏°‡∏¥‡∏Ñ‡∏∏‡πâ‡∏°‡∏Å‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà</li></ul></div>` },
        {
            title: "2. ‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ó‡∏î‡πÅ‡∏ó‡∏ô", icon: "fa-seedling", color: "text-emerald-500",
            content: `<div class="space-y-3 text-sm text-slate-600">
            <p>‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ "‡πÄ‡∏†‡∏™‡∏±‡∏ä‡πÇ‡∏†‡∏ä‡∏ô‡∏†‡∏±‡∏ì‡∏ë‡πå" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÇ‡∏£‡∏Ñ‡∏ó‡∏î‡πÅ‡∏ó‡∏ô‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞:</p>
            <div class="grid grid-cols-2 gap-2">
            <div class="bg-emerald-50 p-2.5 rounded-lg border border-emerald-200"><h4 class="font-bold text-emerald-700 text-xs mb-1">‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô</h4><p class="text-xs text-slate-500">‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏†‡∏π‡∏°‡∏¥‡∏Ñ‡∏∏‡πâ‡∏°‡∏Å‡∏±‡∏ô‡∏à‡∏≥‡πÄ‡∏û‡∏≤‡∏∞ ‡∏•‡∏î‡∏ï‡∏¥‡∏î‡πÄ‡∏ä‡∏∑‡πâ‡∏≠</p></div>
            <div class="bg-blue-50 p-2.5 rounded-lg border border-blue-200"><h4 class="font-bold text-blue-700 text-xs mb-1">Probiotics</h4><p class="text-xs text-slate-500">‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏à‡∏∏‡∏•‡∏¥‡∏ô‡∏ó‡∏£‡∏µ‡∏¢‡πå‡∏•‡∏≥‡πÑ‡∏™‡πâ</p></div>
            <div class="bg-amber-50 p-2.5 rounded-lg border border-amber-200"><h4 class="font-bold text-amber-600 text-xs mb-1">‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£</h4><p class="text-xs text-slate-500">‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏†‡∏π‡∏°‡∏¥‡∏Ñ‡∏∏‡πâ‡∏°‡∏Å‡∏±‡∏ô ‡∏ï‡πâ‡∏≤‡∏ô‡πÄ‡∏ä‡∏∑‡πâ‡∏≠</p></div>
            <div class="bg-purple-50 p-2.5 rounded-lg border border-purple-200"><h4 class="font-bold text-purple-700 text-xs mb-1">‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏ä‡∏µ‡∏ß‡∏†‡∏≤‡∏û</h4><p class="text-xs text-slate-500">Phage Therapy, ‡∏Å‡∏£‡∏î‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏µ‡∏¢‡πå</p></div>
            </div></div>` },
        {
            title: "3. ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡πÄ‡∏ä‡∏¥‡∏á‡∏õ‡∏£‡∏∞‡∏à‡∏±‡∏Å‡∏©‡πå", icon: "fa-book-open", color: "text-indigo-500",
            content: `<div class="space-y-3 text-sm text-slate-600">
            <p>‡∏ú‡∏•‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏≤‡∏£‡∏ó‡∏î‡πÅ‡∏ó‡∏ô:</p>
            <ul class="list-disc pl-5 space-y-1 mb-3"><li><strong>Meta-analysis (2017):</strong> Probiotics ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏° ADG ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏ô‡∏±‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</li>
            <li><strong>‡∏Å‡∏£‡∏ì‡∏µ‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÑ‡∏ó‡∏¢:</strong> ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö "‡∏™‡∏≤‡∏£‡∏™‡∏Å‡∏±‡∏î‡∏Ç‡πà‡∏≤" vs "Colistin"</li></ul>
            <div class="overflow-x-auto"><table class="w-full text-xs border border-slate-200 rounded-lg overflow-hidden">
            <thead class="bg-slate-100"><tr><th class="px-3 py-2 text-left text-slate-700">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏î‡∏•‡∏≠‡∏á</th><th class="px-3 py-2 text-left text-slate-700">ADG (‡∏Å./‡∏ß‡∏±‡∏ô)</th></tr></thead>
            <tbody><tr class="border-t border-slate-200"><td class="px-3 py-2">‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°</td><td class="px-3 py-2">491.79</td></tr>
            <tr class="border-t border-slate-200 bg-emerald-50"><td class="px-3 py-2 font-bold text-emerald-700">‡∏™‡∏≤‡∏£‡∏™‡∏Å‡∏±‡∏î‡∏Ç‡πà‡∏≤ 2 ‡∏Å‡∏Å./‡∏ï‡∏±‡∏ô</td><td class="px-3 py-2 font-bold text-emerald-700">595.23</td></tr>
            <tr class="border-t border-slate-200"><td class="px-3 py-2">Colistin 150 ppm</td><td class="px-3 py-2">598.01</td></tr></tbody></table></div>
            <p class="text-xs text-slate-500">‡∏™‡∏£‡∏∏‡∏õ: ‡∏™‡∏≤‡∏£‡∏™‡∏Å‡∏±‡∏î‡∏Ç‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏î‡∏µ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞</p></div>` }
    ],
    ssuis: [
        {
            title: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö", icon: "fa-heartbeat", color: "text-red-500",
            content: `<div class="space-y-3 text-sm text-slate-600">
            <p>‡πÄ‡∏ä‡∏∑‡πâ‡∏≠ <em class="text-red-500">Streptococcus suis</em> ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏Ñ‡∏ó‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡πÉ‡∏ô‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏∏‡∏Å‡∏£:</p>
            <div class="grid grid-cols-2 gap-2">
            <div class="metric-card"><div class="num text-red-500 bg-none" style="background:none;-webkit-text-fill-color:initial">5-20%</div><p class="text-xs text-slate-500 mt-1">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ï‡∏≤‡∏¢</p></div>
            <div class="metric-card"><div class="num text-orange-500 bg-none" style="background:none;-webkit-text-fill-color:initial">~100%</div><p class="text-xs text-slate-500 mt-1">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏û‡∏≤‡∏´‡∏∞</p></div>
            </div>
            <ul class="list-disc pl-5 space-y-1"><li><strong class="text-slate-800">‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à:</strong> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏±‡∏Å‡∏©‡∏≤ ‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï</li>
            <li><strong class="text-slate-800">‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç:</strong> Zoonosis ‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï (‡∏´‡∏π‡∏î‡∏±‡∏ö,‡πÄ‡∏¢‡∏∑‡πà‡∏≠‡∏´‡∏∏‡πâ‡∏°‡∏™‡∏°‡∏≠‡∏á‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö)</li></ul></div>` },
        {
            title: "1. ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏≤‡∏î", icon: "fa-microscope", color: "text-blue-500",
            content: `<div class="space-y-3 text-sm text-slate-600">
            <p>‡πÅ‡∏ö‡∏Ñ‡∏ó‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡πÅ‡∏Å‡∏£‡∏°‡∏ö‡∏ß‡∏Å ‡∏Å‡∏•‡∏° (Coccus) ‡∏°‡∏µ‡πÅ‡∏Ñ‡∏õ‡∏ã‡∏π‡∏• ‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà ‡∏û‡∏ö 29 ‡∏ã‡∏µ‡πÇ‡∏£‡πÑ‡∏ó‡∏õ‡πå ‡πÇ‡∏î‡∏¢ <strong class="text-blue-600">Serotype 2</strong> ‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</p>
            <p>‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á: ‡∏™‡∏∏‡∏Å‡∏£‡∏´‡∏¢‡πà‡∏≤‡∏ô‡∏°‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• (5-10 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå)</p>
            <div class="bg-blue-50 p-3 rounded-lg border border-blue-200 space-y-1">
            <p class="font-bold text-blue-700 text-xs">‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÇ‡∏ô‡πâ‡∏°‡∏ô‡∏≥</p>
            <p class="text-xs text-slate-500">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î ¬∑ ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô ¬∑ ‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÑ‡∏°‡πà‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏ó ¬∑ ‡∏†‡∏π‡∏°‡∏¥‡∏Ñ‡∏∏‡πâ‡∏°‡∏Å‡∏±‡∏ô‡∏ï‡∏Å</p>
            <p class="font-bold text-blue-700 text-xs mt-2">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡πÅ‡∏û‡∏£‡πà‡πÄ‡∏ä‡∏∑‡πâ‡∏≠</p>
            <p class="text-xs text-slate-500">‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏à‡∏°‡∏π‡∏Å ¬∑ ‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏ô ¬∑ ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏õ‡∏ô‡πÄ‡∏õ‡∏∑‡πâ‡∏≠‡∏ô</p></div></div>` },
        {
            title: "2. ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏¢‡πÇ‡∏£‡∏Ñ", icon: "fa-stethoscope", color: "text-purple-500",
            content: `<div class="space-y-3 text-sm text-slate-600">
            <p>‡πÑ‡∏Ç‡πâ‡∏™‡∏π‡∏á (40.5-41.5 ¬∞C) ‡∏≠‡∏≤‡∏à‡∏ï‡∏≤‡∏¢‡πÄ‡∏â‡∏µ‡∏¢‡∏ö‡∏û‡∏•‡∏±‡∏ô</p>
            <ul class="list-disc pl-5 space-y-1"><li><strong class="text-slate-800">‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ó:</strong> ‡∏ä‡∏±‡∏Å‡πÄ‡∏Å‡∏£‡πá‡∏á ‡∏Ç‡∏≤‡∏ß‡πà‡∏≤‡∏¢‡∏ô‡πâ‡∏≥ ‡∏Ñ‡∏≠‡πÅ‡∏Ç‡πá‡∏á (Meningitis)</li>
            <li><strong class="text-slate-800">‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠:</strong> ‡∏Ç‡πâ‡∏≠‡∏ö‡∏ß‡∏° ‡πÄ‡∏î‡∏¥‡∏ô‡∏Å‡∏∞‡πÄ‡∏ú‡∏•‡∏Å</li>
            <li><strong class="text-slate-800">‡∏£‡∏≠‡∏¢‡πÇ‡∏£‡∏Ñ:</strong> ‡πÄ‡∏¢‡∏∑‡πà‡∏≠‡∏´‡∏∏‡πâ‡∏°‡∏™‡∏°‡∏≠‡∏á‡∏Ç‡∏∏‡πà‡∏ô‡∏°‡∏µ‡∏´‡∏ô‡∏≠‡∏á / Fibrinous Polyserositis</li></ul></div>` },
        {
            title: "3. ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°", icon: "fa-pills", color: "text-emerald-500",
            content: `<div class="space-y-3 text-sm text-slate-600">
            <div class="space-y-2">
            <div class="flex items-start gap-2"><span class="w-1 h-8 bg-blue-400 rounded-full flex-shrink-0 mt-0.5"></span><div><h4 class="font-bold text-blue-600 text-xs">‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢</h4><p class="text-xs">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ + ‡∏£‡∏≠‡∏¢‡πÇ‡∏£‡∏Ñ + ‡πÅ‡∏•‡πá‡∏ö (‡πÄ‡∏û‡∏≤‡∏∞‡πÄ‡∏ä‡∏∑‡πâ‡∏≠/PCR)</p></div></div>
            <div class="flex items-start gap-2"><span class="w-1 h-8 bg-emerald-400 rounded-full flex-shrink-0 mt-0.5"></span><div><h4 class="font-bold text-emerald-600 text-xs">‡∏£‡∏±‡∏Å‡∏©‡∏≤</h4><p class="text-xs">Beta-lactams (Penicillin, Amoxicillin) ‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö</p></div></div>
            <div class="flex items-start gap-2"><span class="w-1 h-8 bg-amber-400 rounded-full flex-shrink-0 mt-0.5"></span><div><h4 class="font-bold text-amber-600 text-xs">‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô</h4><p class="text-xs">Biosecurity + ‡∏•‡∏î‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î + ‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠ + ‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô</p></div></div>
            </div></div>` }
    ],
    gender_amr: [
        {
            title: "‡∏ö‡∏ó‡∏™‡∏£‡∏∏‡∏õ (Executive Summary)", icon: "fa-clipboard-list", color: "text-red-500",
            content: `<div class="space-y-3 text-sm text-slate-600">
            <p><strong class="text-red-600">‡πÅ‡∏Å‡πà‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤:</strong> ‡πÄ‡∏û‡∏®‡∏™‡∏†‡∏≤‡∏û‡πÄ‡∏õ‡πá‡∏ô "‡∏ï‡∏±‡∏ß‡πÄ‡∏£‡πà‡∏á" AMR</p>
            <ul class="list-disc pl-5 space-y-1"><li><strong class="text-pink-600">‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á:</strong> ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•/‡∏î‡πà‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤/‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡∏£‡∏≤‡∏¢‡∏¢‡πà‡∏≠‡∏¢ <em>‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏ô‡πâ‡∏≠‡∏¢</em></li>
            <li><strong class="text-blue-600">‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢:</strong> ‡∏°‡∏≠‡∏á‡∏ß‡πà‡∏≤‡πÑ‡∏õ‡∏´‡∏≤‡∏´‡∏°‡∏≠ = ‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏≠ ‚Üí ‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏ä‡πâ‡∏≤ + ‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏ú‡∏¥‡∏î‡∏ß‡∏¥‡∏ò‡∏µ</li>
            <li><strong class="text-amber-600">‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢:</strong> ‡∏Ç‡∏≤‡∏î‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡πÄ‡∏û‡∏® ‚Üí ‡πÅ‡∏Å‡πâ AMR ‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°</li></ul></div>` },
        {
            title: "1. ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢", icon: "fa-chart-pie", color: "text-blue-500",
            content: `<div class="space-y-3 text-sm text-slate-600">
            <div class="bg-blue-50 p-3 rounded-lg border border-blue-200 mb-2"><p class="font-bold text-blue-700 text-xs text-center">"‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡πÅ‡∏¢‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÄ‡∏û‡∏® ‡∏Ñ‡∏∑‡∏≠‡∏Å‡πâ‡∏≤‡∏ß‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏à‡∏∏‡∏î"</p></div>
            <ul class="list-disc pl-5 space-y-1"><li>GLASS (2021): ‡∏à‡∏≤‡∏Å 70 ‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® ‡∏°‡∏µ‡πÄ‡∏û‡∏µ‡∏¢‡∏á <em>‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô</em> ‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• AST ‡∏ï‡∏≤‡∏°‡πÄ‡∏û‡∏®</li>
            <li>‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏π‡∏£‡∏ì‡∏≤‡∏Å‡∏≤‡∏£‡∏°‡∏¥‡∏ï‡∏¥‡∏ó‡∏≤‡∏á‡πÄ‡∏û‡∏®‡πÄ‡∏Ç‡πâ‡∏≤ National Action Plans ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏±‡∏á</li></ul></div>` },
        {
            title: "2. ‡∏Ñ‡∏£‡∏±‡∏ß‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏ä‡∏∏‡∏°‡∏ä‡∏ô", icon: "fa-home", color: "text-emerald-500",
            content: `<div class="space-y-3 text-sm text-slate-600">
            <p class="font-bold text-emerald-600 text-xs">üë© ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á</p>
            <ul class="list-disc pl-5 space-y-1"><li><strong>Caregiver:</strong> ‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏¥‡∏î‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢ ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡∏∑‡πâ‡∏≠</li>
            <li><strong>‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô:</strong> ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏¢‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û</li>
            <li><strong>WASH:</strong> ‡∏ï‡∏±‡∏Å‡∏ô‡πâ‡∏≥=‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏ô‡πâ‡∏≥‡∏õ‡∏ô‡πÄ‡∏õ‡∏∑‡πâ‡∏≠‡∏ô ¬∑ ‡∏™‡∏∏‡∏Ç‡∏≠‡∏ô‡∏≤‡∏°‡∏±‡∏¢‡πÑ‡∏°‡πà‡∏î‡∏µ=UTIs ¬∑ ‡∏ó‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£=‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡πÄ‡∏ä‡∏∑‡πâ‡∏≠</li></ul>
            <p class="text-xs text-slate-500 mt-1">üíä ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡πÄ‡∏ó‡πà‡∏≤‡πÄ‡∏ó‡∏µ‡∏¢‡∏°‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á "‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÄ‡∏≠‡∏á" ‡πÄ‡∏Å‡πá‡∏ö‡∏¢‡∏≤‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ö‡πà‡∏á‡∏¢‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô</p></div>` },
        {
            title: "3. ‡∏™‡∏ñ‡∏≤‡∏ô‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•", icon: "fa-hospital", color: "text-purple-500",
            content: `<div class="space-y-3 text-sm text-slate-600">
            <div class="bg-purple-50 p-3 rounded-lg border border-purple-200 mb-2"><p class="text-xs"><strong class="text-purple-600">üë©‚Äç‚öïÔ∏è ‡∏î‡πà‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤:</strong> ‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á = 70% ‡∏Ç‡∏≠‡∏á‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ó‡∏±‡πà‡∏ß‡πÇ‡∏•‡∏Å ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏î‡∏∑‡πâ‡∏≠‡∏¢‡∏≤</p></div>
            <ul class="list-disc pl-5 space-y-1 text-xs"><li><strong>‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢:</strong> ‡πÑ‡∏°‡πà‡∏Å‡∏•‡πâ‡∏≤‡∏°‡∏≤‡∏´‡∏≤‡∏´‡∏°‡∏≠ ‚Üí ‡∏°‡∏≤‡∏ä‡πâ‡∏≤ ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏Å ‡∏ä‡∏≠‡∏ö‡∏¢‡∏≤‡πÅ‡∏£‡∏á</li>
            <li><strong>‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á:</strong> ‡∏ñ‡∏π‡∏Å‡∏ï‡∏µ‡∏ï‡∏£‡∏≤‡πÉ‡∏ô‡∏ö‡∏≤‡∏á‡πÇ‡∏£‡∏Ñ ‚Üí ‡πÑ‡∏°‡πà‡∏Å‡∏•‡πâ‡∏≤‡∏°‡∏≤‡∏´‡∏≤‡∏´‡∏°‡∏≠</li>
            <li><strong>‡∏≠‡∏Ñ‡∏ï‡∏¥‡∏à‡πà‡∏≤‡∏¢‡∏¢‡∏≤:</strong> ‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡πÑ‡∏î‡πâ‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ä‡∏≤‡∏¢ 27% ‡∏ï‡∏•‡∏≠‡∏î‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</li>
            <li>‡πÉ‡∏ô ICU ‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤ septic shock ‡∏•‡πà‡∏≤‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤</li></ul></div>` },
        {
            title: "4. ‡∏†‡∏≤‡∏Ñ‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡∏£‡∏°", icon: "fa-tractor", color: "text-amber-500",
            content: `<div class="space-y-3 text-sm text-slate-600">
            <div class="bg-amber-50 p-3 rounded-lg border border-amber-200 mb-2"><p class="font-bold text-amber-700 text-xs text-center">"‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å‡∏™‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏°‡∏≠‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÉ‡∏ô‡∏†‡∏≤‡∏Ñ‡∏õ‡∏®‡∏∏‡∏™‡∏±‡∏ï‡∏ß‡πå"</p></div>
            <div class="grid grid-cols-2 gap-2 mb-2">
            <div class="metric-card"><div class="num text-amber-500" style="background:none;-webkit-text-fill-color:initial">400M</div><p class="text-xs text-slate-500">‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏ä‡∏ô‡∏ö‡∏ó‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏õ‡∏®‡∏∏‡∏™‡∏±‡∏ï‡∏ß‡πå</p></div>
            <div class="metric-card"><div class="num text-emerald-500" style="background:none;-webkit-text-fill-color:initial">+20-30%</div><p class="text-xs text-slate-500">‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏ó‡πà‡∏≤‡πÄ‡∏ó‡∏µ‡∏¢‡∏°</p></div>
            </div>
            <ul class="list-disc pl-5 space-y-1 text-xs"><li>‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ AMR ‡∏°‡∏∏‡πà‡∏á‡∏ó‡∏µ‡πà "‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏ä‡∏≤‡∏¢" ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á</li>
            <li>‡∏Ç‡∏≤‡∏î‡∏™‡∏±‡∏ï‡∏ß‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ ‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°</li>
            <li>‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ï‡∏≤‡∏¢ = ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏´‡∏≤‡∏¢ = ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á</li></ul></div>` },
        {
            title: "5. ‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢ (Governance & Policy)", icon: "fa-balance-scale", color: "text-indigo-500",
            content: `<div class="space-y-3 text-sm text-slate-600">
            <div class="grid grid-cols-2 gap-2 mb-2">
            <div class="metric-card"><div class="num text-indigo-500" style="background:none;-webkit-text-fill-color:initial">70%</div><p class="text-xs text-slate-500">‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÇ‡∏•‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏≤‡∏¢</p></div>
            <div class="metric-card"><div class="num text-pink-500" style="background:none;-webkit-text-fill-color:initial">5%</div><p class="text-xs text-slate-500">‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡∏´‡∏ç‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≥</p></div>
            </div>
            <div class="bg-indigo-50 p-3 rounded-lg border border-indigo-200">
            <p class="font-bold text-indigo-700 text-xs mb-1">‚úÖ ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠ WHO</p>
            <ul class="list-disc pl-4 text-xs space-y-1"><li>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡πÉ‡∏ô‡∏Å‡∏•‡πÑ‡∏Å AMR</li>
            <li>‡∏î‡∏∂‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç Gender ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏µ‡∏°‡∏¢‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏≤‡∏ï‡∏¥</li></ul></div></div>` }
    ]
};

let currentTab = 'antibiotics';
let openAccordionIndex = null;

function switchTab(tab) {
    currentTab = tab;
    openAccordionIndex = null;
    renderKnowledgeUI();
}

function toggleAccordion(index) {
    openAccordionIndex = openAccordionIndex === index ? null : index;
    renderKnowledgeUI();
}

function renderKnowledgeUI() {
    const tabAb = document.getElementById('tab-antibiotics');
    const tabSs = document.getElementById('tab-ssuis');
    const tabGa = document.getElementById('tab-gender');

    // Reset all tabs
    [tabAb, tabSs, tabGa].forEach(t => t.className = 'tab-pill inactive');

    if (currentTab === 'antibiotics') {
        tabAb.className = 'tab-pill active-ab';
        document.getElementById('section-title').innerText = '‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞';
        document.getElementById('section-subtitle').innerText = '‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏±‡πà‡∏á‡∏¢‡∏∑‡∏ô‡πÉ‡∏ô‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏Å‡∏£‡∏£‡∏°‡∏õ‡∏®‡∏∏‡∏™‡∏±‡∏ï‡∏ß‡πå';
    } else if (currentTab === 'ssuis') {
        tabSs.className = 'tab-pill active-ss';
        document.getElementById('section-title').innerText = '‡πÇ‡∏£‡∏Ñ‡∏™‡πÄ‡∏ï‡∏£‡∏õ‡πÇ‡∏ï‡∏Ñ‡∏≠‡∏Ñ‡∏Ñ‡∏±‡∏™ ‡∏ã‡∏π‡∏≠‡∏¥‡∏™ (S. suis)';
        document.getElementById('section-subtitle').innerText = '‡∏£‡∏∞‡∏ö‡∏≤‡∏î‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤ ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÇ‡∏£‡∏Ñ';
    } else {
        tabGa.className = 'tab-pill active-ga';
        document.getElementById('section-title').innerText = '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏°‡∏≠‡∏†‡∏≤‡∏Ñ‡∏ó‡∏≤‡∏á‡πÄ‡∏û‡∏®‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏î‡∏∑‡πâ‡∏≠‡∏¢‡∏≤';
        document.getElementById('section-subtitle').innerText = '‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ó‡∏≤‡∏á‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏¥‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏û‡∏£‡πà‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á AMR';
    }

    const container = document.getElementById('accordion-container');
    container.innerHTML = '';
    const items = knowledgeData[currentTab];

    items.forEach((item, index) => {
        const isOpen = openAccordionIndex === index;
        const div = document.createElement('div');
        div.className = `acc-item ${isOpen ? 'open' : ''}`;
        div.innerHTML = `
            <button onclick="toggleAccordion(${index})" class="w-full flex items-center justify-between p-4 text-left transition-colors hover:bg-slate-50">
                <div class="flex items-center gap-3">
                    <i class="fas ${item.icon} text-lg ${item.color}"></i>
                    <span class="font-semibold text-sm md:text-base text-slate-800">${item.title}</span>
                </div>
                <i class="fas ${isOpen ? 'fa-chevron-up text-indigo-500' : 'fa-chevron-down text-slate-400'} text-xs transition-transform"></i>
            </button>
            <div class="acc-body border-t border-slate-200">${item.content}</div>`;
        container.appendChild(div);
    });
}

// Init
renderKnowledgeUI();
// TODO: Insert your Google Gemini API Key here to enable AI features
const apiKey = "AIzaSyBBqJqIg6CTShy1mvyD22N9ynaMKGmFeoM";

// --- Particles ---
(function createParticles() {
    const bg = document.getElementById('bg-animate');
    const colors = ['#e2e8f0', '#bae6fd', '#d9f99d', '#fef08a']; /* Soft pastel light colors */
    for (let i = 0; i < 20; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        const sz = Math.random() * 4 + 2;
        p.style.cssText = `width:${sz}px;height:${sz}px;left:${Math.random() * 100}%;bottom:${-Math.random() * 20}%;background:${colors[i % 4]};animation-duration:${Math.random() * 15 + 10}s;animation-delay:${Math.random() * 10}s`;
        bg.appendChild(p);
    }
})();

// --- Game Data (8 Levels) ---
const levelsData = [
    {
        title: "‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢", pairs: [
            { id: "1-1", text: "S. suis ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", icon: "fa-question-circle", type: "q" },
            { id: "1-1", text: "‡πÅ‡∏ö‡∏Ñ‡∏ó‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡πÅ‡∏Å‡∏£‡∏°‡∏ö‡∏ß‡∏Å", icon: "fa-bacterium", type: "a" },
            { id: "1-2_3", text: "‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà?", icon: "fa-question-circle", type: "q" },
            { id: "1-2_3", text: "‡∏ó‡∏£‡∏á‡∏Å‡∏•‡∏° / ‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà", icon: "fa-circle", type: "a" },
            { id: "2-1", text: "‡πÇ‡∏£‡∏Ñ‡∏ô‡∏µ‡πâ‡∏ï‡∏¥‡∏î‡∏Ñ‡∏ô‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?", icon: "fa-people-arrows", type: "q" },
            { id: "2-1", text: "‡πÑ‡∏î‡πâ (Zoonotic Agent)", icon: "fa-check-circle", type: "a" },
            { id: "2-2", text: "‡∏´‡∏°‡∏π‡∏ä‡πà‡∏ß‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡πÑ‡∏´‡∏ô‡∏õ‡πà‡∏ß‡∏¢‡∏á‡πà‡∏≤‡∏¢‡∏™‡∏∏‡∏î?", icon: "fa-piggy-bank", type: "q" },
            { id: "2-2", text: "5-10 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå", icon: "fa-calendar-week", type: "a" }
        ]
    },
    {
        title: "‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏£‡πà‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏", pairs: [
            { id: "3-1", text: "‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡πÑ‡∏´‡∏ô?", icon: "fa-route", type: "q" },
            { id: "3-1", text: "‡∏ó‡∏≤‡∏á‡∏õ‡∏≤‡∏Å‡πÅ‡∏•‡∏∞‡∏à‡∏°‡∏π‡∏Å", icon: "fa-head-side-mask", type: "a" },
            { id: "3-2", text: "‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÉ‡∏î‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏π‡∏õ‡πà‡∏ß‡∏¢‡∏á‡πà‡∏≤‡∏¢?", icon: "fa-bolt", type: "q" },
            { id: "3-2", text: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î (Stress)", icon: "fa-tired", type: "a" },
            { id: "3-3", text: "‡∏™‡∏†‡∏≤‡∏û‡πÄ‡∏•‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á?", icon: "fa-wind", type: "q" },
            { id: "3-3", text: "‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÑ‡∏°‡πà‡∏î‡∏µ", icon: "fa-smog", type: "a" },
            { id: "3-4", text: "‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏û‡∏≤‡∏´‡∏∞‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á?", icon: "fa-spider", type: "q" },
            { id: "3-4", text: "‡πÅ‡∏°‡∏•‡∏á‡∏ß‡∏±‡∏ô ‡∏ô‡∏Å ‡∏´‡∏ô‡∏π", icon: "fa-crow", type: "a" }
        ]
    },
    {
        title: "‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏¢‡πÇ‡∏£‡∏Ñ", pairs: [
            { id: "4-1", text: "‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠?", icon: "fa-exclamation-circle", type: "q" },
            { id: "4-1", text: "‡∏ï‡∏≤‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏â‡∏µ‡∏¢‡∏ö‡∏û‡∏•‡∏±‡∏ô", icon: "fa-cross", type: "a" },
            { id: "4-2", text: "‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ó‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç?", icon: "fa-brain", type: "q" },
            { id: "4-2", text: "‡πÄ‡∏¢‡∏∑‡πà‡∏≠‡∏´‡∏∏‡πâ‡∏°‡∏™‡∏°‡∏≠‡∏á‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö", icon: "fa-biohazard", type: "a" },
            { id: "4-3", text: "‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏π‡∏õ‡πà‡∏ß‡∏¢?", icon: "fa-walking", type: "q" },
            { id: "4-3", text: "‡πÄ‡∏î‡∏¥‡∏ô‡πÇ‡∏ã‡πÄ‡∏ã / ‡∏Ç‡∏≤‡∏ß‡πà‡∏≤‡∏¢‡∏ô‡πâ‡∏≥", icon: "fa-swimmer", type: "a" },
            { id: "4-4", text: "‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏Ç‡∏≤?", icon: "fa-bone", type: "q" },
            { id: "4-4", text: "‡∏Ç‡πâ‡∏≠‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö ‡∏ö‡∏ß‡∏°", icon: "fa-crutch", type: "a" }
        ]
    },
    {
        title: "‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡πÇ‡∏£‡∏Ñ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°", pairs: [
            { id: "2-3_4", text: "‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡πÑ‡∏´‡∏ô ‡πÅ‡∏•‡∏∞‡∏û‡∏≤‡∏´‡∏∞‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?", icon: "fa-skull-crossbones", type: "q" },
            { id: "2-3_4", text: "‡∏ï‡∏≤‡∏¢ 5-20% ‡∏û‡∏≤‡∏´‡∏∞‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö 100%", icon: "fa-chart-pie", type: "a" },
            { id: "3-5_6", text: "‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á?", icon: "fa-industry", type: "q" },
            { id: "3-5_6", text: "‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô / ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á", icon: "fa-users-slash", type: "a" },
            { id: "4-5_6", text: "‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏ï‡∏≤‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥?", icon: "fa-eye", type: "q" },
            { id: "4-5_6", text: "‡∏ï‡∏≤‡∏ö‡∏≠‡∏î ‡πÅ‡∏•‡∏∞ ‡πÑ‡∏Ç‡πâ‡∏™‡∏π‡∏á 105 ¬∞F+", icon: "fa-fire", type: "a" },
            { id: "5-1_2", text: "‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏∑‡∏≠?", icon: "fa-pills", type: "q" },
            { id: "5-1_2", text: "‡πÄ‡∏û‡∏ô‡∏¥‡∏ã‡∏¥‡∏•‡∏•‡∏¥‡∏ô / ‡∏≠‡∏∞‡∏°‡πá‡∏≠‡∏Å‡∏ã‡∏µ‡∏ã‡∏¥‡∏•‡∏•‡∏¥‡∏ô", icon: "fa-prescription-bottle", type: "a" },
            { id: "5-3", text: "‡∏ß‡∏¥‡∏ò‡∏µ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?", icon: "fa-shield-virus", type: "q" },
            { id: "5-3", text: "‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏ä‡∏µ‡∏ß‡∏†‡∏≤‡∏û", icon: "fa-user-shield", type: "a" },
            { id: "5-4", text: "‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≥‡∏à‡∏±‡∏î‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÉ‡∏ô‡∏ü‡∏≤‡∏£‡πå‡∏°?", icon: "fa-pump-soap", type: "q" },
            { id: "5-4", text: "‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏∏‡∏Ç‡∏≠‡∏ô‡∏≤‡∏°‡∏±‡∏¢/‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠", icon: "fa-broom", type: "a" }
        ]
    },
    {
        title: "‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 5: ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏™‡∏±‡∏á‡∏Ñ‡∏°", pairs: [
            { id: "5-5", text: "‡∏ß‡∏¥‡∏ò‡∏µ‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÇ‡∏£‡∏Ñ?", icon: "fa-vial", type: "q" },
            { id: "5-5", text: "‡πÄ‡∏û‡∏≤‡∏∞‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÅ‡∏ö‡∏Ñ‡∏ó‡∏µ‡πÄ‡∏£‡∏µ‡∏¢", icon: "fa-dna", type: "a" },
            { id: "5-6", text: "‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡πÇ‡∏£‡∏Ñ‡∏≠‡∏∞‡πÑ‡∏£?", icon: "fa-random", type: "q" },
            { id: "5-6", text: "‡πÇ‡∏£‡∏Ñ‡∏Å‡∏•‡∏≤‡∏™‡πÄ‡∏ã‡∏≠‡∏£‡πå", icon: "fa-notes-medical", type: "a" },
            { id: "5-7_8", text: "‡∏£‡∏≠‡∏¢‡πÇ‡∏£‡∏Ñ‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡∏õ‡∏≠‡∏î‡∏Ñ‡∏∑‡∏≠?", icon: "fa-heart-broken", type: "q" },
            { id: "5-7_8", text: "‡∏•‡∏¥‡πâ‡∏ô‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö / ‡∏õ‡∏≠‡∏î‡∏ö‡∏ß‡∏°", icon: "fa-lungs", type: "a" },
            { id: "6-1", text: "‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£", icon: "fa-utensils", type: "q" },
            { id: "6-1", text: "‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏à‡∏≤‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏î‡∏¥‡∏ö", icon: "fa-hand-holding-medical", type: "a" },
            { id: "6-2", text: "‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå 70% ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ç‡∏¥‡∏á", icon: "fa-user-nurse", type: "q" },
            { id: "6-2", text: "‡∏î‡πà‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡∏∑‡πâ‡∏≠", icon: "fa-hospital-user", type: "a" },
            { id: "6-3", text: "‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢‡πÑ‡∏õ‡∏≠‡∏ö‡∏£‡∏° ‡πÅ‡∏ï‡πà‡πÉ‡∏Ñ‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á?", icon: "fa-chalkboard-teacher", type: "q" },
            { id: "6-3", text: "‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á (‡∏Ç‡∏≤‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ)", icon: "fa-female", type: "a" }
        ]
    },
    {
        title: "‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 6: ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô", pairs: [
            { id: "7-1", text: "‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢‡∏Å‡∏•‡∏±‡∏ß‡∏î‡∏π‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏≠", icon: "fa-fist-raised", type: "q" },
            { id: "7-1", text: "‡∏´‡∏≤‡∏´‡∏°‡∏≠‡∏ä‡πâ‡∏≤ / ‡∏ã‡∏∑‡πâ‡∏≠‡∏¢‡∏≤‡∏Å‡∏¥‡∏ô‡πÄ‡∏≠‡∏á", icon: "fa-pills", type: "a" },
            { id: "7-2", text: "‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á", icon: "fa-stethoscope", type: "q" },
            { id: "7-2", text: "‡∏≠‡∏Ñ‡∏ï‡∏¥‡∏à‡πà‡∏≤‡∏¢‡∏¢‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô", icon: "fa-prescription", type: "a" },
            { id: "7-3", text: "‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏ä‡∏≤‡∏¢‡∏•‡πâ‡∏ß‡∏ô", icon: "fa-user-tie", type: "q" },
            { id: "7-3", text: "‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏°‡∏≠‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á", icon: "fa-eye-slash", type: "a" },
            { id: "8-1", text: "‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡∏´‡∏ç‡∏¥‡∏á‡∏ó‡∏∏‡∏ô‡∏ô‡πâ‡∏≠‡∏¢", icon: "fa-coins", type: "q" },
            { id: "8-1", text: "‡∏û‡∏∂‡πà‡∏á‡∏¢‡∏≤‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏¢‡∏∏‡∏á‡∏ä‡∏µ‡∏û", icon: "fa-hand-holding-usd", type: "a" },
            { id: "8-2_3", text: "‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°/‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏™‡∏Å‡∏õ‡∏£‡∏Å", icon: "fa-toilet", type: "q" },
            { id: "8-2_3", text: "‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏î‡∏∑‡πâ‡∏≠‡∏¢‡∏≤ ‡πÅ‡∏•‡∏∞ UTI", icon: "fa-bacteria", type: "a" },
            { id: "8-4", text: "‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• (Carer)", icon: "fa-hands-helping", type: "q" },
            { id: "8-4", text: "‡∏Ç‡∏≤‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ã‡∏∑‡πâ‡∏≠‡∏¢‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û", icon: "fa-money-bill-wave-alt", type: "a" }
        ]
    }
];

// --- Game State ---
let currentLevelIndex = 0, cards = [], hasFlippedCard = false, lockBoard = false;
let firstCard, secondCard, moves = 0, matchedPairs = 0;
let timerInterval, seconds = 0, totalSeconds = 0, gameStarted = false, currentExplanation = "";

// --- MQTT State ---
let mqttClient, isMultiplayer = false, roomId = "", isHost = false;
let myClientId = "client-" + Math.random().toString(16).substr(2, 8);

// --- DOM Elements ---
const gameContainer = document.getElementById('game-container');
const welcomeScreen = document.getElementById('welcome-screen');
const gameBoard = document.getElementById('game-board');
const movesDisplay = document.getElementById('moves');
const timeDisplay = document.getElementById('time');
const levelTitle = document.getElementById('level-title');
const levelModal = document.getElementById('level-modal');
const victoryModal = document.getElementById('victory-modal');
const aiCorner = document.getElementById('ai-corner');
const aiLoading = document.getElementById('ai-loading');
const aiContent = document.getElementById('ai-content');
const aiText = document.getElementById('ai-text');
const aiEmpty = document.getElementById('ai-empty');
const audioLoading = document.getElementById('audio-loading');

// --- Start Game ---
function onStartGame() {
    Swal.fire({
        title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÄ‡∏Å‡∏°...',
        html: '‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°!',
        timer: 1200,
        timerProgressBar: true,
        background: '#ffffff',
        color: '#475569',
        showConfirmButton: false,
        didOpen: () => Swal.showLoading(),
        willClose: () => {
            welcomeScreen.classList.add('hidden');
            gameContainer.classList.remove('hidden');
            initGame(0);
        }
    });
}

function initGame(levelIndex) {
    currentLevelIndex = levelIndex;
    const levelData = levelsData[levelIndex];
    levelTitle.innerText = levelData.title;
    updateLevelIndicator(levelIndex);
    cards = [...levelData.pairs];
    shuffle(cards);
    resetLevelStats();
    renderBoard();
    aiCorner.classList.remove('hidden');
    resetAIBox();
}

function toggleKnowledgeBox() {
    const box = document.getElementById('manual-knowledge-box');
    if (box.classList.contains('hidden')) {
        box.classList.remove('hidden');
        setTimeout(() => box.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
    } else { box.classList.add('hidden'); }
}

function resetAIBox() {
    aiLoading.classList.add('hidden');
    aiContent.classList.add('hidden');
    aiEmpty.classList.remove('hidden');
    aiCorner.classList.remove('ai-pulse');
}

function updateLevelIndicator(index) {
    for (let i = 0; i < 6; i++) {
        const dot = document.getElementById(`dot-${i + 1}`);
        const line = document.getElementById(`line-${i + 1}`);
        dot.className = "level-dot rounded-full border-2 border-slate-600 flex items-center justify-center font-bold text-slate-500";
        if (line) line.className = "level-line";
        if (i < index) { dot.classList.add('completed'); if (line) line.classList.add('filled'); }
        else if (i === index) { dot.classList.add('active'); }
    }
}

function shuffle(arr) { for (let i = arr.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1));[arr[i], arr[j]] = [arr[j], arr[i]]; } }

function renderBoard() {
    gameBoard.innerHTML = '';
    const n = cards.length;
    let gc = 'grid-cols-3 gap-3';
    if (n === 6) gc = 'grid-cols-3 gap-4';
    if (n === 8) gc = 'grid-cols-4 md:grid-cols-4 gap-3';
    if (n >= 12) gc = 'grid-cols-3 md:grid-cols-4 gap-2 md:gap-3';
    if (n === 16) gc = 'grid-cols-4 gap-2';
    gameBoard.className = `grid ${gc} w-full max-w-4xl mx-auto`;

    cards.forEach((item, idx) => {
        const el = document.createElement('div');
        const hc = n >= 12 ? 'h-24 md:h-32' : 'h-32 md:h-40';
        el.className = `card-container w-full ${hc} deal-animate`;
        el.style.animationDelay = `${idx * 60}ms`;

        const typeClass = item.type === 'q' ? 'q-card' : 'a-card';
        const iconColor = item.type === 'q' ? 'text-amber-400' : 'text-emerald-400';

        el.innerHTML = `
            <div class="card w-full h-full" data-id="${item.id}">
                <div class="card-face card-front">
                    <i class="fas fa-question text-current opacity-40"></i>
                </div>
                <div class="card-face card-back ${typeClass} rounded-xl">
                    <i class="fas ${item.icon} text-2xl mb-1 ${iconColor}"></i>
                    <span class="text-content">${item.text}</span>
                </div>
            </div>`;
        const cardInner = el.querySelector('.card');
        cardInner.addEventListener('click', function () { flipCard(this, true); });
        gameBoard.appendChild(el);
    });
}

// --- Gameplay ---
function flipCard(card, isLocal) {
    if (!gameStarted) { startTimer(); gameStarted = true; if (isLocal && isMultiplayer) sendGameAction('START_TIMER', {}); }
    if (lockBoard || card === firstCard || card.classList.contains('flipped')) return;
    if (isLocal && isMultiplayer) { sendGameAction('FLIP', { cardIndex: Array.from(gameBoard.children).indexOf(card.parentElement) }); }
    card.classList.add('flipped');
    if (!hasFlippedCard) { hasFlippedCard = true; firstCard = card; return; }
    secondCard = card; incrementMoves(); checkForMatch();
}

function checkForMatch() {
    firstCard.dataset.id === secondCard.dataset.id ? disableCards() : unflipCards();
}

function disableCards() {
    const c1 = firstCard, c2 = secondCard;
    setTimeout(() => {
        c1.classList.add('matched-glow');
        c2.classList.add('matched-glow');
        const b1 = c1.querySelector('.card-back'), b2 = c2.querySelector('.card-back');
        b1.style.boxShadow = 'inset 0 0 20px rgba(52,211,153,.15)';
        b2.style.boxShadow = 'inset 0 0 20px rgba(52,211,153,.15)';
        b1.innerHTML += '<i class="fas fa-check-circle absolute top-1 right-1 text-emerald-400 text-xs"></i>';
        b2.innerHTML += '<i class="fas fa-check-circle absolute top-1 right-1 text-emerald-400 text-xs"></i>';
    }, 200);
    const t1 = firstCard.querySelector('.text-content').innerText;
    const t2 = secondCard.querySelector('.text-content').innerText;
    fetchAIExplanation(t1, t2, firstCard.dataset.id);
    matchedPairs++;
    resetBoard();
    if (matchedPairs === cards.length / 2) setTimeout(levelComplete, 1500);
}

function unflipCards() {
    lockBoard = true;
    setTimeout(() => { firstCard.classList.remove('flipped'); secondCard.classList.remove('flipped'); resetBoard(); }, 1000);
}
function resetBoard() { [hasFlippedCard, lockBoard] = [false, false];[firstCard, secondCard] = [null, null]; }
function incrementMoves() { moves++; movesDisplay.innerText = moves; }

// --- AI ---
const explanationCache = {};
const backupKnowledge = {
    "1-1": "S. suis ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏Ñ‡∏ó‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å‡∏à‡∏¥‡πã‡∏ß ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏≠‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏à‡∏∏‡∏•‡∏ó‡∏£‡∏£‡∏®‡∏ô‡πå‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ô‡∏∞",
    "1-2_3": "‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏•‡∏°‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏•‡∏π‡∏Å‡∏ö‡∏≠‡∏• ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤ Coccus ‡πÅ‡∏•‡∏∞‡∏Ç‡∏µ‡πâ‡πÄ‡∏Å‡∏µ‡∏¢‡∏à ‡πÑ‡∏°‡πà‡∏ä‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏õ‡πÑ‡∏´‡∏ô (Non-motile)",
    "2-1": "‡∏£‡∏∞‡∏ß‡∏±‡∏á! ‡πÇ‡∏£‡∏Ñ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏™‡∏π‡πà‡∏Ñ‡∏ô (Zoonosis) ‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï",
    "2-2": "‡∏•‡∏π‡∏Å‡∏´‡∏°‡∏π‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• (5-10 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå) ‡∏†‡∏π‡∏°‡∏¥‡∏ï‡∏Å‡∏á‡πà‡∏≤‡∏¢ ‡πÄ‡∏•‡∏¢‡∏õ‡πà‡∏ß‡∏¢‡∏ö‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î",
    "3-1": "‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏≤‡∏á '‡∏õ‡∏≤‡∏Å‡πÅ‡∏•‡∏∞‡∏à‡∏°‡∏π‡∏Å' ‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏°‡∏π‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏Å‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏™‡∏Å‡∏õ‡∏£‡∏Å",
    "3-2": "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î (Stress) ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏π‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏≠ ‡∏à‡∏ô‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÇ‡∏£‡∏Ñ‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡πÑ‡∏î‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
    "3-3": "‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÉ‡∏ô‡πÄ‡∏•‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏ó ‡∏à‡∏∞‡∏™‡∏∞‡∏™‡∏°‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÇ‡∏£‡∏Ñ‡πÑ‡∏ß‡πâ‡πÄ‡∏¢‡∏≠‡∏∞ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏π‡∏õ‡πà‡∏ß‡∏¢‡∏á‡πà‡∏≤‡∏¢",
    "3-4": "‡πÅ‡∏°‡∏•‡∏á‡∏ß‡∏±‡∏ô ‡∏ô‡∏Å ‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡∏π ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≤‡∏¢‡∏•‡∏±‡∏ö‡∏û‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÇ‡∏£‡∏Ñ‡πÑ‡∏õ‡∏ï‡∏¥‡∏î‡∏´‡∏°‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏î‡πâ",
    "4-1": "‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡∏´‡∏°‡∏π‡∏≠‡∏≤‡∏à‡∏ï‡∏≤‡∏¢‡∏Å‡∏∞‡∏ó‡∏±‡∏ô‡∏´‡∏±‡∏ô‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ô‡πÄ‡∏´‡πá‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏¢",
    "4-2": "‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ä‡∏≠‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏°‡∏≠‡∏á ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏¢‡∏∑‡πà‡∏≠‡∏´‡∏∏‡πâ‡∏°‡∏™‡∏°‡∏≠‡∏á‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö ‡∏´‡∏°‡∏π‡∏à‡∏∞‡∏ä‡∏±‡∏Å‡πÄ‡∏Å‡∏£‡πá‡∏á",
    "4-3": "‡∏´‡∏°‡∏π‡∏à‡∏∞‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏ã‡∏ó‡∏£‡∏á‡∏ï‡∏±‡∏ß‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡∏ô‡∏≠‡∏ô‡∏ï‡∏∞‡∏Å‡∏∏‡∏¢‡∏Ç‡∏≤‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏¢‡∏ô‡πâ‡∏≥",
    "4-4": "‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏ö‡∏ß‡∏°‡πÅ‡∏î‡∏á ‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏à‡πá‡∏ö‡∏Ç‡∏≤",
    "2-3_4": "‡∏´‡∏°‡∏π‡∏õ‡πà‡∏ß‡∏¢‡∏≠‡∏≤‡∏à‡∏ï‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á 20% ‡πÅ‡∏ï‡πà‡∏´‡∏°‡∏π‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏ù‡∏π‡∏á‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏≤‡∏´‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÑ‡∏ß‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î‡πÄ‡∏ß‡∏•‡∏≤!",
    "3-5_6": "‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÅ‡∏ô‡πà‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏û‡∏±‡∏Å‡πÄ‡∏•‡πâ‡∏≤ (Continuous) ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏•‡∏∞‡πÅ‡∏¢‡πà‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà ‡∏à‡∏ô‡∏´‡∏°‡∏π‡∏õ‡πà‡∏ß‡∏¢‡∏á‡πà‡∏≤‡∏¢",
    "4-5_6": "‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏≤‡∏à‡∏ô‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏≤‡∏ö‡∏≠‡∏î‡πÑ‡∏î‡πâ ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏π‡∏°‡∏µ‡πÑ‡∏Ç‡πâ‡∏™‡∏π‡∏á‡∏ï‡∏±‡∏ß‡∏£‡πâ‡∏≠‡∏ô‡∏à‡∏µ‡πã‡∏ñ‡∏∂‡∏á 105-106 ¬∞F",
    "5-1_2": "‡∏¢‡∏≤‡πÄ‡∏û‡∏ô‡∏¥‡∏ã‡∏¥‡∏•‡∏•‡∏¥‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Æ‡∏µ‡πÇ‡∏£‡πà‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏≤‡∏ö‡πÄ‡∏ä‡∏∑‡πâ‡∏≠ ‡πÅ‡∏•‡∏∞‡∏¢‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏∞‡∏°‡πá‡∏≠‡∏Å‡∏ã‡∏µ‡∏ã‡∏¥‡∏•‡∏•‡∏¥‡∏ô‡∏Å‡πá‡πÉ‡∏ä‡πâ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏î‡∏µ‡πÄ‡∏ä‡πà‡∏ô‡∏Å‡∏±‡∏ô",
    "5-3": "Biosecurity ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÇ‡∏£‡∏Ñ ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏Å‡∏£‡∏≤‡∏∞‡∏ß‡∏¥‡πÄ‡∏®‡∏©‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°",
    "5-4": "‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏°‡∏±‡πà‡∏ô‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÉ‡∏ô‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏à‡∏±‡∏î‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÇ‡∏£‡∏Ñ",
    "5-5": "‡∏Ñ‡∏∏‡∏ì‡∏´‡∏°‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏≥‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÑ‡∏õ‡πÄ‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πá‡∏ö ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÇ‡∏£‡∏Ñ‡πÑ‡∏î‡πâ‡∏ä‡∏±‡∏ß‡∏£‡πå‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î",
    "5-6": "‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡πÇ‡∏£‡∏Ñ '‡∏Å‡∏•‡∏≤‡∏™‡πÄ‡∏ã‡∏≠‡∏£‡πå' ‡∏°‡∏≤‡∏Å ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏´‡∏°‡∏≠‡πÅ‡∏¢‡∏Å‡πÇ‡∏£‡∏Ñ‡πÉ‡∏´‡πâ‡∏î‡∏µ",
    "5-7_8": "‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏∞‡∏õ‡∏ô‡πÉ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÑ‡∏õ‡πÄ‡∏Å‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏•‡∏¥‡πâ‡∏ô‡∏´‡∏±‡∏ß‡πÉ‡∏à ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö ‡πÅ‡∏•‡∏∞‡∏•‡∏á‡∏õ‡∏≠‡∏î‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏≠‡∏î‡∏ö‡∏ß‡∏°",
    "6-1": "‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏°‡∏±‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏ó‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏à‡∏≤‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏°‡∏π‡∏î‡∏¥‡∏ö‡∏ú‡πà‡∏≤‡∏ô‡∏ö‡∏≤‡∏î‡πÅ‡∏ú‡∏•‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤",
    "6-2": "‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏¥‡∏î‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏î‡∏∑‡πâ‡∏≠‡∏¢‡∏≤",
    "6-3": "‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢‡∏°‡∏±‡∏Å‡πÑ‡∏î‡πâ‡πÑ‡∏õ‡∏≠‡∏ö‡∏£‡∏° ‡πÅ‡∏ï‡πà‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏à‡∏£‡∏¥‡∏á ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏≤‡πÑ‡∏õ‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ô‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô",
    "7-1": "‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢‡∏ö‡∏≤‡∏á‡∏Ñ‡∏ô‡∏Å‡∏•‡∏±‡∏ß‡∏î‡∏π‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏≠ (Toxic Masculinity) ‡πÄ‡∏•‡∏¢‡πÑ‡∏°‡πà‡πÑ‡∏õ‡∏´‡∏≤‡∏´‡∏°‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡∏ã‡∏∑‡πâ‡∏≠‡∏¢‡∏≤‡∏Å‡∏¥‡∏ô‡πÄ‡∏≠‡∏á‡∏°‡∏±‡πà‡∏ß‡πÜ ‡∏à‡∏ô‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏î‡∏∑‡πâ‡∏≠‡∏¢‡∏≤",
    "7-2": "‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ö‡∏≤‡∏á‡∏ó‡πà‡∏≤‡∏ô‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏≠‡∏Ñ‡∏ï‡∏¥ ‡∏à‡πà‡∏≤‡∏¢‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏á‡πà‡∏≤‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏≠ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏î‡∏∑‡πâ‡∏≠‡∏¢‡∏≤",
    "7-3": "‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏°‡∏µ‡πÅ‡∏ï‡πà‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢ ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡πà‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡∏°‡∏≠‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ",
    "8-1": "‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡∏´‡∏ç‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏≤‡∏Å‡∏à‡∏ô ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏ñ‡∏π‡∏Å‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏¢‡∏∏‡∏á‡∏ä‡∏µ‡∏û‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏î",
    "8-2_3": "‡πÄ‡∏î‡πá‡∏Å‡πÄ‡∏•‡πà‡∏ô‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÅ‡∏â‡∏∞‡∏´‡∏£‡∏∑‡∏≠‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÑ‡∏°‡πà‡∏™‡∏∞‡∏≠‡∏≤‡∏î ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏ï‡∏¥‡∏î‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞‡∏á‡πà‡∏≤‡∏¢ (UTI) ‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏î‡∏∑‡πâ‡∏≠‡∏¢‡∏≤‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô",
    "8-4": "‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏î‡∏π‡πÅ‡∏•‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô ‡∏Å‡πá‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏¢‡∏≤‡∏ä‡∏∏‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ"
};

async function fetchAIExplanation(term1, term2, pairId) {
    aiEmpty.classList.add('hidden'); aiContent.classList.add('hidden');
    aiLoading.classList.remove('hidden'); aiCorner.classList.add('ai-pulse');
    const cacheKey = [term1, term2].sort().join('||');
    if (pairId && backupKnowledge[pairId]) { currentExplanation = backupKnowledge[pairId]; setTimeout(() => displayAIResult(currentExplanation), 500); return; }
    if (explanationCache[cacheKey]) { currentExplanation = explanationCache[cacheKey]; displayAIResult(currentExplanation); return; }
    const fallback = `‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á "${term1}" ‡πÅ‡∏•‡∏∞ "${term2}" ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÇ‡∏£‡∏Ñ S. suis`;
    try {
        const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ contents: [{ parts: [{ text: `Explain the connection between '${term1}' and '${term2}' regarding AMR and Gender roles in One Health context. Keep it very short, simple, fun, and educational for a Thai primary student. Max 2 short sentences in Thai.` }] }] })
        });
        if (!r.ok) throw new Error('fail');
        const d = await r.json();
        const t = d.candidates?.[0]?.content?.parts?.[0]?.text;
        if (t) { currentExplanation = t; explanationCache[cacheKey] = t; } else { currentExplanation = fallback; }
    } catch { currentExplanation = fallback + " (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏£‡∏≠‡∏á)"; }
    displayAIResult(currentExplanation);
}

function displayAIResult(text) {
    aiLoading.classList.add('hidden'); aiCorner.classList.remove('ai-pulse');
    aiContent.classList.remove('hidden'); aiText.innerText = text;
}

async function playAIAudio() {
    if (!currentExplanation) return;
    const btn = document.getElementById('btn-play-audio'), ld = document.getElementById('audio-loading');
    btn.disabled = true; btn.classList.add('opacity-50'); ld.classList.remove('hidden');
    try {
        const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`, {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ contents: [{ parts: [{ text: "Say in a teaching tone: " + currentExplanation }] }], generationConfig: { responseModalities: ["AUDIO"], speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Aoede" } } } } })
        });
        if (!r.ok) throw new Error('tts');
        const d = await r.json(), ab = d.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
        if (ab) { const ac = new (window.AudioContext || window.webkitAudioContext)(); const bs = atob(ab); const by = new Uint8Array(bs.length); for (let i = 0; i < bs.length; i++)by[i] = bs.charCodeAt(i); const wb = pcm16ToWav(by, 24000); const bl = new Blob([wb], { type: 'audio/wav' }); const au = new Audio(URL.createObjectURL(bl)); au.play(); au.onended = () => { btn.disabled = false; btn.classList.remove('opacity-50'); }; } else throw new Error('no audio');
    } catch { const u = new SpeechSynthesisUtterance(currentExplanation); u.lang = 'th-TH'; speechSynthesis.speak(u); btn.disabled = false; btn.classList.remove('opacity-50'); }
    finally { ld.classList.add('hidden'); }
}

function pcm16ToWav(d, sr) { const nc = 1, bps = 16, br = sr * nc * bps / 8, ba = nc * bps / 8, h = new ArrayBuffer(44), v = new DataView(h); const ws = (v, o, s) => { for (let i = 0; i < s.length; i++)v.setUint8(o + i, s.charCodeAt(i)) }; ws(v, 0, 'RIFF'); v.setUint32(4, 36 + d.length, true); ws(v, 8, 'WAVE'); ws(v, 12, 'fmt '); v.setUint32(16, 16, true); v.setUint16(20, 1, true); v.setUint16(22, nc, true); v.setUint32(24, sr, true); v.setUint32(28, br, true); v.setUint16(32, ba, true); v.setUint16(34, bps, true); ws(v, 36, 'data'); v.setUint32(40, d.length, true); const w = new Uint8Array(h.byteLength + d.length); w.set(new Uint8Array(h), 0); w.set(d, h.byteLength); return w; }

// --- Timer ---
function startTimer() { clearInterval(timerInterval); timerInterval = setInterval(() => { seconds++; totalSeconds++; updateTimeDisplay(); }, 1000); }
function updateTimeDisplay() { timeDisplay.innerText = `${String(Math.floor(seconds / 60)).padStart(2, '0')}:${String(seconds % 60).padStart(2, '0')}`; }
function resetLevelStats() { moves = 0; seconds = 0; matchedPairs = 0; gameStarted = false; clearInterval(timerInterval); movesDisplay.innerText = '0'; timeDisplay.innerText = '00:00';[hasFlippedCard, lockBoard] = [false, false];[firstCard, secondCard] = [null, null]; }

// --- Game Flow ---
function levelComplete() {
    clearInterval(timerInterval);
    document.getElementById('modal-level-num').innerText = currentLevelIndex + 1;
    document.getElementById('level-time').innerText = timeDisplay.innerText;
    document.getElementById('level-moves').innerText = moves;
    if (currentLevelIndex < levelsData.length - 1) {
        document.getElementById('modal-msg').innerText = "‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å! ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡πà‡∏≤‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ";
        levelModal.classList.remove('hidden');
    } else { showVictory(); }
}

function nextLevel(isLocal = true) {
    if (isLocal && isMultiplayer) sendGameAction('NEXT_LEVEL', {});
    levelModal.classList.add('hidden'); initGame(currentLevelIndex + 1);
}

function showVictory() {
    const m = String(Math.floor(totalSeconds / 60)).padStart(2, '0'), s = String(totalSeconds % 60).padStart(2, '0');
    document.getElementById('total-time').innerText = `${m}:${s}`;
    victoryModal.classList.remove('hidden');
    spawnConfetti();
}

function restartGame(isLocal = true) {
    if (isLocal && isMultiplayer) sendGameAction('RESTART', {});
    victoryModal.classList.add('hidden');
    welcomeScreen.classList.remove('hidden');
    gameContainer.classList.add('hidden');
    totalSeconds = 0;
}

// --- Confetti ---
function spawnConfetti() {
    const zone = document.getElementById('confetti-zone');
    zone.className = 'confetti-container';
    zone.innerHTML = '';
    const colors = ['#fde68a', '#a7f3d0', '#c7d2fe', '#fbcfe8', '#bae6fd', '#fed7aa'];
    for (let i = 0; i < 60; i++) {
        const p = document.createElement('div');
        p.className = 'confetti-piece';
        const c = colors[Math.floor(Math.random() * colors.length)];
        const shapes = ['50%', '0'];
        p.style.cssText = `left:${Math.random() * 100}%;background:${c};border-radius:${shapes[Math.floor(Math.random() * 2)]};width:${Math.random() * 8 + 6}px;height:${Math.random() * 8 + 6}px;animation-duration:${Math.random() * 2 + 2}s;animation-delay:${Math.random() * 1.5}s`;
        zone.appendChild(p);
    }
    setTimeout(() => { zone.innerHTML = ''; }, 5000);
}

// --- MQTT ---
function openMultiplayerModal() {
    if (isMultiplayer) { if (confirm('‡∏ï‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠?')) disconnectMQTT(); }
    else document.getElementById('multiplayer-modal').classList.remove('hidden');
}
function connectMQTT() {
    const input = document.getElementById('room-id-input').value.trim();
    if (!input) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á");
    roomId = input;
    document.getElementById('multiplayer-modal').classList.add('hidden');
    const btn = document.getElementById('btn-multiplayer');
    btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...';
    mqttClient = new Paho.MQTT.Client("broker.emqx.io", 8083, myClientId);
    mqttClient.onConnectionLost = onConnectionLost;
    mqttClient.onMessageArrived = onMessageArrived;
    mqttClient.connect({ onSuccess: onConnect, onFailure: onFailure, keepAliveInterval: 30 });
}
function onConnect() {
    isMultiplayer = true;
    const btn = document.getElementById('btn-multiplayer');
    btn.className = "stat-pill text-emerald-300 border-emerald-500/20 cursor-pointer";
    btn.innerHTML = `<i class="fas fa-circle text-xs text-emerald-400 mr-1"></i>‡∏´‡πâ‡∏≠‡∏á: ${roomId}`;
    mqttClient.subscribe(`ssuis-game/${roomId}/action`);
}
function onFailure(r) { alert("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: " + r.errorMessage); resetMultiplayerUI(); }
function onConnectionLost(r) { if (r.errorCode !== 0) console.log("Lost:" + r.errorMessage); resetMultiplayerUI(); }
function disconnectMQTT() { if (mqttClient) mqttClient.disconnect(); resetMultiplayerUI(); }
function resetMultiplayerUI() {
    isMultiplayer = false;
    const btn = document.getElementById('btn-multiplayer');
    btn.className = "stat-pill text-blue-300 border-blue-500/20 hover:bg-blue-500/10 transition cursor-pointer";
    btn.innerHTML = '<i class="fas fa-users text-xs"></i><span>‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</span>';
}
function sendGameAction(type, payload) {
    if (!mqttClient || !isMultiplayer) return;
    const m = new Paho.MQTT.Message(JSON.stringify({ sender: myClientId, type, payload }));
    m.destinationName = `ssuis-game/${roomId}/action`; mqttClient.send(m);
}
function onMessageArrived(msg) {
    try {
        const d = JSON.parse(msg.payloadString); if (d.sender === myClientId) return;
        switch (d.type) { case 'FLIP': handleRemoteFlip(d.payload.cardIndex); break; case 'START_TIMER': if (!gameStarted) { startTimer(); gameStarted = true; } break; case 'NEXT_LEVEL': nextLevel(false); break; case 'RESTART': restartGame(false); break; }
    } catch (e) { console.error(e); }
}
function handleRemoteFlip(idx) { const c = gameBoard.children[idx]; if (c) { const card = c.querySelector('.card'); if (card && !card.classList.contains('flipped')) flipCard(card, false); } }

    </script>
</body>

</html>
